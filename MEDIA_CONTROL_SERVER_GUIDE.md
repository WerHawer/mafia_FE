# ðŸ“¡ WebSocket Media Control Events - Server Implementation Guide

## ÐžÐ³Ð»ÑÐ´
Ð¦ÐµÐ¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ Ð¾Ð¿Ð¸ÑÑƒÑ” WebSocket Ð¿Ð¾Ð´Ñ–Ñ— Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽ Ð°ÑƒÐ´Ñ–Ð¾/Ð²Ñ–Ð´ÐµÐ¾ Ñ‡ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€.

**Ð’ÐÐ–Ð›Ð˜Ð’Ðž:** Ð’ÐµÑÑŒ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ð¼ÐµÐ´Ñ–Ð° Ð¿Ñ€Ð¾Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€. ÐšÐ»Ñ–Ñ”Ð½Ñ‚ ÐÐ• ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑ” LiveKit API Ð½Ð°Ð¿Ñ€ÑÐ¼Ñƒ - Ñ‚Ñ–Ð»ÑŒÐºÐ¸ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÑÑ” Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€, ÑÐºÐ¸Ð¹ ÐºÐµÑ€ÑƒÑ” LiveKit Server API.

## ðŸ“¥ ÐŸÐ¾Ð´Ñ–Ñ— Ð²Ñ–Ð´ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð° Ð´Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°

### 1. `toggleUserCamera`
Ð—Ð°Ð¿Ð¸Ñ‚ Ð½Ð° Ð²Ð¼Ð¸ÐºÐ°Ð½Ð½Ñ/Ð²Ð¸Ð¼Ð¸ÐºÐ°Ð½Ð½Ñ ÐºÐ°Ð¼ÐµÑ€Ð¸ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°.

**Payload:**
```typescript
{
  userId: string;      // ID ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°, ÐºÐ°Ð¼ÐµÑ€Ñƒ ÑÐºÐ¾Ð³Ð¾ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽÐ²Ð°Ñ‚Ð¸
  enabled: boolean;    // true - ÑƒÐ²Ñ–Ð¼ÐºÐ½ÑƒÑ‚Ð¸, false - Ð²Ð¸Ð¼ÐºÐ½ÑƒÑ‚Ð¸
}
```

**ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´:**
```typescript
socket.emit('toggleUserCamera', {
  userId: 'user123',
  enabled: false
});
```

**Ð›Ð¾Ð³Ñ–ÐºÐ° Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ñ–:**
1. ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸ Ð¿Ñ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ (ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽÑ” ÑÐµÐ±Ðµ Ð°Ð±Ð¾ Ñ†Ðµ GM)
2. **ÐžÐ½Ð¾Ð²Ð¸Ñ‚Ð¸ ÑÑ‚Ð°Ð½ ÐºÐ°Ð¼ÐµÑ€Ð¸ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° Ð² LiveKit Ñ‡ÐµÑ€ÐµÐ· Server API**
3. Ð’Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð¸Ñ‚Ð¸ Ð¿Ð¾Ð´Ñ–ÑŽ `userCameraStatusChanged` Ð²ÑÑ–Ð¼ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ°Ð¼ ÐºÑ–Ð¼Ð½Ð°Ñ‚Ð¸

**Ð’ÐÐ–Ð›Ð˜Ð’Ðž:** Ð¡ÐµÑ€Ð²ÐµÑ€ ÐºÐµÑ€ÑƒÑ” LiveKit - ÐºÐ»Ñ–Ñ”Ð½Ñ‚ Ñ‚Ñ–Ð»ÑŒÐºÐ¸ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÑÑ” Ð·Ð°Ð¿Ð¸Ñ‚!

---

### 2. `toggleUserMicrophone`
Ð—Ð°Ð¿Ð¸Ñ‚ Ð½Ð° Ð²Ð¼Ð¸ÐºÐ°Ð½Ð½Ñ/Ð²Ð¸Ð¼Ð¸ÐºÐ°Ð½Ð½Ñ Ð¼Ñ–ÐºÑ€Ð¾Ñ„Ð¾Ð½Ð° ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°.

**Payload:**
```typescript
{
  userId: string;      // ID ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°, Ð¼Ñ–ÐºÑ€Ð¾Ñ„Ð¾Ð½ ÑÐºÐ¾Ð³Ð¾ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽÐ²Ð°Ñ‚Ð¸
  enabled: boolean;    // true - ÑƒÐ²Ñ–Ð¼ÐºÐ½ÑƒÑ‚Ð¸, false - Ð²Ð¸Ð¼ÐºÐ½ÑƒÑ‚Ð¸
}
```

**ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´:**
```typescript
socket.emit('toggleUserMicrophone', {
  userId: 'user123',
  enabled: true
});
```

**Ð›Ð¾Ð³Ñ–ÐºÐ° Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ñ–:**
1. ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸ Ð¿Ñ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ (ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽÑ” ÑÐµÐ±Ðµ Ð°Ð±Ð¾ Ñ†Ðµ GM)
2. ÐžÐ½Ð¾Ð²Ð¸Ñ‚Ð¸ ÑÑ‚Ð°Ð½ Ð¼Ñ–ÐºÑ€Ð¾Ñ„Ð¾Ð½Ð° ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° Ð² LiveKit Ñ‡ÐµÑ€ÐµÐ· Server API
3. Ð’Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð¸Ñ‚Ð¸ Ð¿Ð¾Ð´Ñ–ÑŽ `userMicrophoneStatusChanged` Ð²ÑÑ–Ð¼ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ°Ð¼ ÐºÑ–Ð¼Ð½Ð°Ñ‚Ð¸

---

## ðŸ“¤ ÐŸÐ¾Ð´Ñ–Ñ— Ð²Ñ–Ð´ ÑÐµÑ€Ð²ÐµÑ€Ð° Ð´Ð¾ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð°

### 1. `userCameraStatusChanged`
ÐŸÐ¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ð¿Ñ€Ð¾ Ð·Ð¼Ñ–Ð½Ñƒ ÑÑ‚Ð°Ð½Ñƒ ÐºÐ°Ð¼ÐµÑ€Ð¸ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°.

**Payload:**
```typescript
{
  userId: string;      // ID ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°, ÑÑ‚Ð°Ð½ ÐºÐ°Ð¼ÐµÑ€Ð¸ ÑÐºÐ¾Ð³Ð¾ Ð·Ð¼Ñ–Ð½Ð¸Ð²ÑÑ
  enabled: boolean;    // true - ÐºÐ°Ð¼ÐµÑ€Ð° ÑƒÐ²Ñ–Ð¼ÐºÐ½ÐµÐ½Ð°, false - Ð²Ð¸Ð¼ÐºÐ½ÐµÐ½Ð°
}
```

**ÐšÐ¾Ð»Ð¸ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÑÑ”Ñ‚ÑŒÑÑ:**
- ÐŸÑ–ÑÐ»Ñ ÑƒÑÐ¿Ñ–ÑˆÐ½Ð¾Ñ— Ð·Ð¼Ñ–Ð½Ð¸ ÑÑ‚Ð°Ð½Ñƒ ÐºÐ°Ð¼ÐµÑ€Ð¸ Ñ‡ÐµÑ€ÐµÐ· `toggleUserCamera`
- ÐŸÑ€Ð¸ Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ–/Ð²Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ– ÐºÐ°Ð¼ÐµÑ€Ð¸ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ÐµÐ¼
- ÐŸÑ€Ð¸ Ð²Ñ…Ð¾Ð´Ñ– Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° Ð² ÐºÑ–Ð¼Ð½Ð°Ñ‚Ñƒ (ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ñ–Ð·Ð°Ñ†Ñ–Ñ ÑÑ‚Ð°Ð½Ñƒ)

---

### 2. `userMicrophoneStatusChanged`
ÐŸÐ¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ð¿Ñ€Ð¾ Ð·Ð¼Ñ–Ð½Ñƒ ÑÑ‚Ð°Ð½Ñƒ Ð¼Ñ–ÐºÑ€Ð¾Ñ„Ð¾Ð½Ð° ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°.

**Payload:**
```typescript
{
  userId: string;      // ID ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°, ÑÑ‚Ð°Ð½ Ð¼Ñ–ÐºÑ€Ð¾Ñ„Ð¾Ð½Ð° ÑÐºÐ¾Ð³Ð¾ Ð·Ð¼Ñ–Ð½Ð¸Ð²ÑÑ
  enabled: boolean;    // true - Ð¼Ñ–ÐºÑ€Ð¾Ñ„Ð¾Ð½ ÑƒÐ²Ñ–Ð¼ÐºÐ½ÐµÐ½Ð¸Ð¹, false - Ð²Ð¸Ð¼ÐºÐ½ÐµÐ½Ð¸Ð¹
}
```

**ÐšÐ¾Ð»Ð¸ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÑÑ”Ñ‚ÑŒÑÑ:**
- ÐŸÑ–ÑÐ»Ñ ÑƒÑÐ¿Ñ–ÑˆÐ½Ð¾Ñ— Ð·Ð¼Ñ–Ð½Ð¸ ÑÑ‚Ð°Ð½Ñƒ Ð¼Ñ–ÐºÑ€Ð¾Ñ„Ð¾Ð½Ð° Ñ‡ÐµÑ€ÐµÐ· `toggleUserMicrophone`
- ÐŸÑ€Ð¸ Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ–/Ð²Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ– Ð¼Ñ–ÐºÑ€Ð¾Ñ„Ð¾Ð½Ð° ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ÐµÐ¼
- ÐŸÑ€Ð¸ Ð²Ñ…Ð¾Ð´Ñ– Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° Ð² ÐºÑ–Ð¼Ð½Ð°Ñ‚Ñƒ (ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ñ–Ð·Ð°Ñ†Ñ–Ñ ÑÑ‚Ð°Ð½Ñƒ)

---

## ðŸ” ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ

### Ð¥Ñ‚Ð¾ Ð¼Ð¾Ð¶Ðµ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽÐ²Ð°Ñ‚Ð¸ Ð¼ÐµÐ´Ñ–Ð°:
1. **ÐšÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡** - Ð¼Ð¾Ð¶Ðµ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽÐ²Ð°Ñ‚Ð¸ Ñ‚Ñ–Ð»ÑŒÐºÐ¸ ÑÐ²Ð¾Ñ— Ð²Ð»Ð°ÑÐ½Ñ– Ð°ÑƒÐ´Ñ–Ð¾/Ð²Ñ–Ð´ÐµÐ¾
2. **Game Master (GM)** - Ð¼Ð¾Ð¶Ðµ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽÐ²Ð°Ñ‚Ð¸ Ð°ÑƒÐ´Ñ–Ð¾/Ð²Ñ–Ð´ÐµÐ¾ Ð±ÑƒÐ´ÑŒ-ÑÐºÐ¾Ð³Ð¾ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ°

### ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð¿Ñ€Ð°Ð² Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ñ–:
```typescript
const canControl = (requesterId: string, targetUserId: string, isGM: boolean): boolean => {
  return requesterId === targetUserId || isGM;
};
```

---

## ðŸŽ¯ ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´ ÑÐµÑ€Ð²ÐµÑ€Ð½Ð¾Ñ— Ñ€ÐµÐ°Ð»Ñ–Ð·Ð°Ñ†Ñ–Ñ— (Node.js + Socket.io + LiveKit)

```typescript
import { RoomServiceClient, TrackSource } from 'livekit-server-sdk';

const livekitClient = new RoomServiceClient(
  LIVEKIT_URL,
  LIVEKIT_API_KEY,
  LIVEKIT_API_SECRET
);

io.on('connection', (socket) => {
  
  // ÐžÐ±Ñ€Ð¾Ð±ÐºÐ° Ð²Ð¼Ð¸ÐºÐ°Ð½Ð½Ñ/Ð²Ð¸Ð¼Ð¸ÐºÐ°Ð½Ð½Ñ ÐºÐ°Ð¼ÐµÑ€Ð¸
  socket.on('toggleUserCamera', async (data: { userId: string; enabled: boolean }) => {
    try {
      const { userId, enabled } = data;
      const requesterId = socket.data.userId; // ID ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°, Ñ‰Ð¾ Ñ€Ð¾Ð±Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸Ñ‚
      const isGM = socket.data.isGM; // Ð§Ð¸ Ñ” ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ GM
      const roomName = socket.data.roomName; // ÐÐ°Ð·Ð²Ð° ÐºÑ–Ð¼Ð½Ð°Ñ‚Ð¸
      
      // ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð¿Ñ€Ð°Ð² Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ
      if (requesterId !== userId && !isGM) {
        socket.emit('error', { message: 'Access denied' });
        return;
      }
      
      // âœ… ÐžÐ½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ ÑÑ‚Ð°Ð½Ñƒ ÐºÐ°Ð¼ÐµÑ€Ð¸ Ñ‡ÐµÑ€ÐµÐ· LiveKit Server API
      await livekitClient.updateParticipant(roomName, userId, {
        // ÐœÑƒÑ‚Ð¸Ð¼Ð¾ Ñ‚Ñ€ÐµÐº, ÑÐºÑ‰Ð¾ enabled = false
        permission: {
          canPublish: true,
          canSubscribe: true,
        },
      });
      
      // ÐœÑƒÑ‚Ð¸Ð¼Ð¾ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¸Ð¹ Ñ‚Ñ€ÐµÐº ÐºÐ°Ð¼ÐµÑ€Ð¸
      await livekitClient.mutePublishedTrack(
        roomName, 
        userId, 
        TrackSource.CAMERA,
        !enabled // true ÑÐºÑ‰Ð¾ Ð²Ð¸Ð¼Ð¸ÐºÐ°Ñ”Ð¼Ð¾ (mute), false ÑÐºÑ‰Ð¾ Ð²Ð¼Ð¸ÐºÐ°Ñ”Ð¼Ð¾ (unmute)
      );
      
      // ÐŸÐ¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ð²ÑÑ–Ð¼ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ°Ð¼ ÐºÑ–Ð¼Ð½Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾ Ð·Ð¼Ñ–Ð½Ñƒ ÑÑ‚Ð°Ð½Ñƒ
      io.to(roomName).emit('userCameraStatusChanged', {
        userId,
        enabled,
      });
      
      console.log(`Camera ${enabled ? 'enabled' : 'disabled'} for user ${userId} by ${requesterId}`);
    } catch (error) {
      console.error('Error toggling camera:', error);
      socket.emit('error', { message: 'Failed to toggle camera' });
    }
  });
  
  // ÐžÐ±Ñ€Ð¾Ð±ÐºÐ° Ð²Ð¼Ð¸ÐºÐ°Ð½Ð½Ñ/Ð²Ð¸Ð¼Ð¸ÐºÐ°Ð½Ð½Ñ Ð¼Ñ–ÐºÑ€Ð¾Ñ„Ð¾Ð½Ð°
  socket.on('toggleUserMicrophone', async (data: { userId: string; enabled: boolean }) => {
    try {
      const { userId, enabled } = data;
      const requesterId = socket.data.userId;
      const isGM = socket.data.isGM;
      const roomName = socket.data.roomName;
      
      // ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð¿Ñ€Ð°Ð² Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ
      if (requesterId !== userId && !isGM) {
        socket.emit('error', { message: 'Access denied' });
        return;
      }
      
      // âœ… ÐžÐ½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ ÑÑ‚Ð°Ð½Ñƒ Ð¼Ñ–ÐºÑ€Ð¾Ñ„Ð¾Ð½Ð° Ñ‡ÐµÑ€ÐµÐ· LiveKit Server API
      await livekitClient.mutePublishedTrack(
        roomName, 
        userId, 
        TrackSource.MICROPHONE,
        !enabled // true ÑÐºÑ‰Ð¾ Ð²Ð¸Ð¼Ð¸ÐºÐ°Ñ”Ð¼Ð¾ (mute), false ÑÐºÑ‰Ð¾ Ð²Ð¼Ð¸ÐºÐ°Ñ”Ð¼Ð¾ (unmute)
      );
      
      // ÐŸÐ¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ð²ÑÑ–Ð¼ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ°Ð¼ ÐºÑ–Ð¼Ð½Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾ Ð·Ð¼Ñ–Ð½Ñƒ ÑÑ‚Ð°Ð½Ñƒ
      io.to(roomName).emit('userMicrophoneStatusChanged', {
        userId,
        enabled,
      });
      
      console.log(`Microphone ${enabled ? 'enabled' : 'disabled'} for user ${userId} by ${requesterId}`);
    } catch (error) {
      console.error('Error toggling microphone:', error);
      socket.emit('error', { message: 'Failed to toggle microphone' });
    }
  });
  
});
```

---

## ðŸ”„ ÐŸÐ¾Ñ‚Ñ–Ðº Ð´Ð°Ð½Ð¸Ñ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚                    â”‚  Server  â”‚                    â”‚ LiveKit  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                               â”‚                               â”‚
     â”‚ toggleUserCamera              â”‚                               â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                               â”‚
     â”‚  {userId, enabled}            â”‚                               â”‚
     â”‚                               â”‚                               â”‚
     â”‚                               â”‚ updateParticipant             â”‚
     â”‚                               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                               â”‚                               â”‚
     â”‚                               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                               â”‚           OK                  â”‚
     â”‚                               â”‚                               â”‚
     â”‚ userCameraStatusChanged       â”‚                               â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                               â”‚
     â”‚  {userId, enabled}            â”‚                               â”‚
     â”‚                               â”‚                               â”‚
     â”‚                               â”‚ (broadcast to all clients     â”‚
     â”‚                               â”‚  in the room)                 â”‚
     â”‚                               â”‚                               â”‚
```

---

## âš ï¸ Ð’Ð°Ð¶Ð»Ð¸Ð²Ñ– Ð¿Ñ€Ð¸Ð¼Ñ–Ñ‚ÐºÐ¸

1. **Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ñ–Ð·Ð°Ñ†Ñ–Ñ ÑÑ‚Ð°Ð½Ñƒ**: ÐŸÑ€Ð¸ Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ– Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°, ÑÐµÑ€Ð²ÐµÑ€ Ð¼Ð°Ñ” Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð¸Ñ‚Ð¸ Ð¹Ð¾Ð¼Ñƒ Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ð¸Ð¹ ÑÑ‚Ð°Ð½ Ð²ÑÑ–Ñ… ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð²
2. **ÐžÐ±Ñ€Ð¾Ð±ÐºÐ° Ð¿Ð¾Ð¼Ð¸Ð»Ð¾Ðº**: ÐžÐ±Ð¾Ð²'ÑÐ·ÐºÐ¾Ð²Ð¾ Ð¾Ð±Ñ€Ð¾Ð±Ð»ÑÐ¹Ñ‚Ðµ Ð²Ð¸Ð¿Ð°Ð´ÐºÐ¸, ÐºÐ¾Ð»Ð¸ LiveKit API Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ð¹
3. **Ð›Ð¾Ð³ÑƒÐ²Ð°Ð½Ð½Ñ**: Ð›Ð¾Ð³ÑƒÐ¹Ñ‚Ðµ Ð²ÑÑ– Ð·Ð¼Ñ–Ð½Ð¸ ÑÑ‚Ð°Ð½Ñ–Ð² Ð´Ð»Ñ Ð°ÑƒÐ´Ð¸Ñ‚Ñƒ
4. **Rate limiting**: ÐžÐ±Ð¼ÐµÐ¶Ñ‚Ðµ ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŒ Ð·Ð°Ð¿Ð¸Ñ‚Ñ–Ð² Ð½Ð° Ð·Ð¼Ñ–Ð½Ñƒ ÑÑ‚Ð°Ð½Ñƒ (Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, Ð½Ðµ Ð±Ñ–Ð»ÑŒÑˆÐµ 1 Ð·Ð°Ð¿Ð¸Ñ‚Ñƒ Ð½Ð° ÑÐµÐºÑƒÐ½Ð´Ñƒ)
5. **WebSocket reconnection**: ÐšÐ»Ñ–Ñ”Ð½Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð¿ÐµÑ€ÐµÐ¿Ñ–Ð´ÐºÐ»ÑŽÑ‡Ð°Ñ”Ñ‚ÑŒÑÑ, Ð°Ð»Ðµ ÑÑ‚Ð°Ð½ Ð¼Ð¾Ð¶Ðµ Ð´ÐµÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ñ–Ð·ÑƒÐ²Ð°Ñ‚Ð¸ÑÑŒ - Ð¿ÐµÑ€ÐµÐ´Ð±Ð°Ñ‡Ñ‚Ðµ Ð¼ÐµÑ…Ð°Ð½Ñ–Ð·Ð¼ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ñ–Ð·Ð°Ñ†Ñ–Ñ—

---

## ðŸ“‹ Ð§ÐµÐºÐ»Ð¸ÑÑ‚ Ð´Ð»Ñ ÑÐµÑ€Ð²ÐµÑ€Ð½Ð¾Ñ— Ñ€ÐµÐ°Ð»Ñ–Ð·Ð°Ñ†Ñ–Ñ—

- [ ] Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ð¾Ð±Ñ€Ð¾Ð±Ð½Ð¸ÐºÐ¸ `toggleUserCamera` Ñ‚Ð° `toggleUserMicrophone`
- [ ] Ð ÐµÐ°Ð»Ñ–Ð·ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÑƒ Ð¿Ñ€Ð°Ð² Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ
- [ ] Ð†Ð½Ñ‚ÐµÐ³Ñ€ÑƒÐ²Ð°Ñ‚Ð¸ Ð· LiveKit Server API
- [ ] Ð”Ð¾Ð´Ð°Ñ‚Ð¸ broadcast Ð¿Ð¾Ð´Ñ–Ð¹ `userCameraStatusChanged` Ñ‚Ð° `userMicrophoneStatusChanged`
- [ ] Ð ÐµÐ°Ð»Ñ–Ð·ÑƒÐ²Ð°Ñ‚Ð¸ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ñ–Ð·Ð°Ñ†Ñ–ÑŽ ÑÑ‚Ð°Ð½Ñƒ Ð¿Ñ€Ð¸ Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ–
- [ ] Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ð¾Ð±Ñ€Ð¾Ð±ÐºÑƒ Ð¿Ð¾Ð¼Ð¸Ð»Ð¾Ðº
- [ ] Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ð»Ð¾Ð³ÑƒÐ²Ð°Ð½Ð½Ñ
- [ ] Ð”Ð¾Ð´Ð°Ñ‚Ð¸ rate limiting
- [ ] ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚ÑƒÐ²Ð°Ñ‚Ð¸ Ð· Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¸Ð¼Ð¸ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°Ð¼Ð¸

